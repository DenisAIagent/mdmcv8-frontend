<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> | MDMC SmartLinks</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="<%= description %>">
  <meta name="keywords" content="<%= artist.name %>, <%= track.title %>, musique, streaming, MDMC">
  <meta name="author" content="MDMC Music Ads">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:type" content="music.song">
  <meta property="og:title" content="<%= title %>">
  <meta property="og:description" content="<%= description %>">
  <meta property="og:image" content="<%= image %>">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="<%= url %>">
  <meta property="og:site_name" content="MDMC SmartLinks">
  <meta property="og:locale" content="fr_FR">
  
  <!-- Music Specific Open Graph -->
  <meta property="music:song" content="<%= track.title %>">
  <meta property="music:musician" content="<%= artist.name %>">
  <meta property="music:release_date" content="<%= new Date().toISOString() %>">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= title %>">
  <meta name="twitter:description" content="<%= description %>">
  <meta name="twitter:image" content="<%= image %>">
  <meta name="twitter:site" content="@MDMCMusicAds">
  <meta name="twitter:creator" content="@MDMCMusicAds">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="<%= url %>">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="<%= baseUrl %>/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="<%= baseUrl %>/apple-touch-icon.png">
  
  <!-- Fonts - Inter pour modernité optimale -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Analytics - Google Analytics 4 -->
  <% if (analyticsEnabled && gaId) { %>
  <script async src="https://www.googletagmanager.com/gtag/js?id=<%= gaId %>"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '<%= gaId %>', {
      page_title: '<%= title %>',
      page_location: '<%= url %>',
      custom_map: {
        'custom_parameter_1': 'artist_name',
        'custom_parameter_2': 'track_title'
      }
    });
    
    // Track SmartLink view
    gtag('event', 'smartlink_view', {
      event_category: 'SmartLink',
      event_label: '<%= artist.name %> - <%= track.title %>',
      artist_name: '<%= artist.name %>',
      track_title: '<%= track.title %>',
      artist_slug: '<%= artist.slug %>',
      track_slug: '<%= track.slug %>'
    });
  </script>
  <% } %>
  
  <!-- Meta Pixel -->
  <% if (analyticsEnabled && metaPixelId) { %>
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '<%= metaPixelId %>');
    fbq('track', 'PageView');
    fbq('track', 'ViewContent', {
      content_type: 'music',
      content_name: '<%= track.title %>',
      content_category: 'SmartLink'
    });
  </script>
  <noscript>
    <img height="1" width="1" style="display:none" 
         src="https://www.facebook.com/tr?id=<%= metaPixelId %>&ev=PageView&noscript=1"/>
  </noscript>
  <% } %>

  <style>
    /* ================================
       MDMC SMARTLINKS - DESIGN MODERNE 2025
       Background Blur + Glassmorphism + Audio Player
       ================================ */
    
    /* Reset et Variables */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      /* Couleurs MDMC */
      --mdmc-red: #cc271a;
      --mdmc-red-dark: #a61e14;
      --mdmc-red-light: #e63946;
      
      /* Couleurs modernes */
      --black: #000000;
      --white: #ffffff;
      --glass-bg: rgba(255, 255, 255, 0.25);
      --glass-border: rgba(255, 255, 255, 0.3);
      --glass-shadow: rgba(0, 0, 0, 0.15);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --text-muted: rgba(255, 255, 255, 0.6);
      
      /* Typography */
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      
      /* Spacing */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --space-10: 2.5rem;
      --space-12: 3rem;
      
      /* Radius */
      --radius-sm: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --radius-2xl: 2rem;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.25);
      
      /* Transitions */
      --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Blur */
      --blur-sm: blur(4px);
      --blur-md: blur(8px);
      --blur-lg: blur(16px);
      --blur-xl: blur(24px);
    }
    
    /* Base */
    html {
      font-size: 16px;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      font-family: var(--font-family);
      font-weight: 400;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
    }
    
    /* Background avec artwork flou */
    .background-artwork {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: var(--blur-lg);
      transform: scale(1.1);
    }
    
    .background-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.7) 0%,
        rgba(0, 0, 0, 0.5) 50%,
        rgba(0, 0, 0, 0.8) 100%
      );
    }
    
    /* Container principal - Glassmorphism */
    .smartlink-container {
      width: 100%;
      max-width: 380px;
      backdrop-filter: var(--blur-md);
      -webkit-backdrop-filter: var(--blur-md);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      position: relative;
    }
    
    /* Header moderne avec artwork et player */
    .smartlink-header {
      position: relative;
      padding: var(--space-8) var(--space-6) var(--space-6);
      text-align: center;
    }
    
    /* Artwork container avec bouton play intégré */
    .artwork-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto var(--space-6);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      transition: var(--transition-base);
    }
    
    .artwork-container:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-xl);
    }
    
    .cover-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    /* Bouton Play sur l'artwork */
    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 64px;
      height: 64px;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
      box-shadow: var(--shadow-lg);
      z-index: 10;
    }
    
    .play-button:hover {
      background: var(--white);
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: var(--shadow-xl);
    }
    
    .play-button svg {
      width: 24px;
      height: 24px;
      fill: var(--black);
      margin-left: 2px;
    }
    
    .play-button.playing svg {
      margin-left: 0;
    }
    
    /* Audio Player (hidden) */
    .audio-player {
      display: none;
    }
    
    /* Track info */
    .track-info h1 {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-2);
      line-height: 1.2;
      letter-spacing: -0.02em;
    }
    
    .track-info h2 {
      font-size: var(--font-size-lg);
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: var(--space-3);
      letter-spacing: -0.01em;
    }
    
    .track-subtitle {
      font-size: var(--font-size-sm);
      color: var(--text-muted);
      font-style: italic;
    }
    
    /* Content area */
    .smartlink-content {
      padding: 0 var(--space-6) var(--space-8);
    }
    
    .description {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: var(--space-8);
      line-height: 1.6;
    }
    
    /* Platform links - Design moderne */
    .platforms-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }
    
    .platform-link {
      display: flex;
      align-items: center;
      padding: var(--space-4) var(--space-5);
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-lg);
      text-decoration: none;
      color: var(--text-primary);
      font-weight: 500;
      font-size: var(--font-size-base);
      transition: var(--transition-base);
      position: relative;
      overflow: hidden;
    }
    
    .platform-link:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .platform-link:active {
      transform: translateY(0);
    }
    
    /* Platform logos SVG */
    .platform-logo {
      width: 24px;
      height: 24px;
      margin-right: var(--space-4);
      flex-shrink: 0;
    }
    
    .platform-name {
      flex: 1;
      font-weight: 500;
    }
    
    .platform-arrow {
      margin-left: auto;
      font-size: var(--font-size-lg);
      color: var(--text-muted);
      transition: var(--transition-base);
    }
    
    .platform-link:hover .platform-arrow {
      transform: translateX(4px);
      color: var(--text-primary);
    }
    
    /* Footer glassmorphism */
    .smartlink-footer {
      padding: var(--space-6);
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .powered-by {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      margin-bottom: var(--space-2);
    }
    
    .powered-by a {
      color: var(--mdmc-red-light);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition-fast);
    }
    
    .powered-by a:hover {
      color: var(--text-primary);
      text-decoration: underline;
    }
    
    .mdmc-tagline {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      font-style: italic;
      opacity: 0.8;
    }
    
    /* Animations d'entrée */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .smartlink-container {
      animation: scaleIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .artwork-container {
      animation: fadeInUp 1s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
    }
    
    .track-info {
      animation: fadeInUp 1s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
    }
    
    .platform-link {
      animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) both;
    }
    
    <% if (typeof platforms !== 'undefined' && platforms.length > 0) { %>
    <% platforms.forEach((platform, index) => { %>
    .platform-link:nth-child(<%= index + 1 %>) {
      animation-delay: <%= (index * 0.1) + 0.6 %>s;
    }
    <% }); %>
    <% } %>
    
    /* Responsive Mobile-First */
    @media (max-width: 640px) {
      body {
        padding: var(--space-3);
      }
      
      .smartlink-container {
        max-width: 100%;
      }
      
      .smartlink-header {
        padding: var(--space-6) var(--space-5) var(--space-5);
      }
      
      .artwork-container {
        width: 180px;
        height: 180px;
      }
      
      .play-button {
        width: 56px;
        height: 56px;
      }
      
      .play-button svg {
        width: 20px;
        height: 20px;
      }
      
      .track-info h1 {
        font-size: var(--font-size-xl);
      }
      
      .track-info h2 {
        font-size: var(--font-size-base);
      }
      
      .smartlink-content {
        padding: 0 var(--space-5) var(--space-6);
      }
      
      .platform-link {
        padding: var(--space-3) var(--space-4);
        font-size: var(--font-size-sm);
      }
      
      .platform-logo {
        width: 20px;
        height: 20px;
        margin-right: var(--space-3);
      }
    }
    
    @media (max-width: 480px) {
      .smartlink-header {
        padding: var(--space-5) var(--space-4) var(--space-4);
      }
      
      .artwork-container {
        width: 160px;
        height: 160px;
      }
      
      .play-button {
        width: 48px;
        height: 48px;
      }
      
      .play-button svg {
        width: 18px;
        height: 18px;
      }
      
      .track-info h1 {
        font-size: var(--font-size-lg);
      }
      
      .smartlink-content {
        padding: 0 var(--space-4) var(--space-5);
      }
    }
    
    /* Accessibilité */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    .platform-link:focus {
      outline: 2px solid var(--mdmc-red-light);
      outline-offset: 2px;
    }
    
    .play-button:focus {
      outline: 2px solid var(--mdmc-red-light);
      outline-offset: 2px;
    }
    
    /* High contrast mode */
    @media (prefers-contrast: high) {
      :root {
        --glass-bg: rgba(255, 255, 255, 0.9);
        --glass-border: rgba(255, 255, 255, 0.8);
        --text-primary: #ffffff;
        --text-secondary: #ffffff;
      }
    }
  </style>
</head>

<body>
  <!-- Background avec artwork flou -->
  <div class="background-artwork" style="background-image: url('<%= image %>')"></div>
  <div class="background-overlay"></div>

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MusicRecording",
    "name": "<%= track.title %>",
    "byArtist": {
      "@type": "MusicGroup",
      "name": "<%= artist.name %>"
    },
    "description": "<%= description %>",
    "image": "<%= image %>",
    "url": "<%= url %>",
    "publisher": {
      "@type": "Organization",
      "name": "MDMC Music Ads",
      "url": "<%= brandUrl %>"
    },
    "datePublished": "<%= new Date().toISOString() %>"
  }
  </script>

  <main class="smartlink-container" role="main">
    <!-- Header moderne avec artwork et player -->
    <header class="smartlink-header">
      <div class="artwork-container">
        <img 
          src="<%= image %>" 
          alt="Pochette de <%= track.title %> par <%= artist.name %>"
          class="cover-image"
          loading="eager"
        >
        
        <!-- Bouton Play Audio intégré -->
        <button class="play-button" id="playButton" aria-label="Lire l'extrait audio">
          <svg viewBox="0 0 24 24" id="playIcon">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg viewBox="0 0 24 24" id="pauseIcon" style="display: none;">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
        
        <!-- Lecteur Audio (caché) -->
        <audio class="audio-player" id="audioPlayer" preload="metadata">
          <% if (track.previewUrl) { %>
          <source src="<%= track.previewUrl %>" type="audio/mpeg">
          <% } %>
          Votre navigateur ne supporte pas l'élément audio.
        </audio>
      </div>
      
      <div class="track-info">
        <h1><%= track.title %></h1>
        <h2><%= artist.name %></h2>
        <% if (track.subtitle) { %>
        <p class="track-subtitle"><%= track.subtitle %></p>
        <% } %>
      </div>
    </header>
    
    <!-- Contenu principal -->
    <section class="smartlink-content">
      <% if (description) { %>
      <p class="description"><%= description %></p>
      <% } %>
      
      <!-- Liste des plateformes avec vrais logos -->
      <nav class="platforms-list" role="navigation" aria-label="Liens vers les plateformes de streaming">
        <% platforms.forEach((platform, index) => { %>
        <a 
          href="<%= platform.url %>" 
          class="platform-link platform-<%= platform.platform %>"
          target="_blank" 
          rel="noopener noreferrer"
          onclick="trackPlatformClick('<%= platform.platform %>', '<%= artist.slug %>', '<%= track.slug %>')"
          aria-label="Écouter <%= track.title %> sur <%= platform.displayName %>"
        >
          <!-- Logo SVG de la plateforme -->
          <div class="platform-logo" aria-hidden="true">
            <% if (platform.platform === 'spotify') { %>
              <svg viewBox="0 0 24 24" fill="#1DB954">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
            <% } else if (platform.platform === 'apple') { %>
              <svg viewBox="0 0 24 24" fill="#FA243C">
                <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
              </svg>
            <% } else if (platform.platform === 'youtube') { %>
              <svg viewBox="0 0 24 24" fill="#FF0000">
                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
              </svg>
            <% } else if (platform.platform === 'deezer') { %>
              <svg viewBox="0 0 24 24" fill="#FEAA2D">
                <path d="M18.81 8.71h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm-3.23-6.45h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm-3.23-8.6h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm0 2.15h2.69v1.64h-2.69zm-3.23-10.75h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zm0 2.15h2.69v1.64H9.32zM6.09 4.25h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09zm0 2.15h2.69v1.64H6.09z"/>
              </svg>
            <% } else if (platform.platform === 'tidal') { %>
              <svg viewBox="0 0 24 24" fill="#000000">
                <path d="M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996l4.004 4.004L0 16.004l4.004 4.004 4.004-4.004 4.004 4.004 4.004-4.004-4.004-4.004 4.004-4.004-4.004-4.004zm0 0l4.004 4.004L20.02 3.992 24.024 7.996l-4.004 4.004 4.004 4.004-4.004 4.004-4.004-4.004-4.004 4.004-4.004-4.004 4.004-4.004-4.004-4.004z"/>
              </svg>
            <% } else if (platform.platform === 'amazon') { %>
              <svg viewBox="0 0 24 24" fill="#00A8E1">
                <path d="M18.996 24c-3.456 0-6.12-1.392-7.68-3.84l1.728-1.152c1.152 1.824 3.072 2.784 5.952 2.784 2.4 0 4.32-.864 4.32-2.4 0-1.44-.96-2.016-3.264-2.4l-2.208-.384c-2.88-.48-4.608-1.824-4.608-4.416 0-2.88 2.4-4.8 6.048-4.8 2.88 0 5.28 1.152 6.624 3.264l-1.728 1.056c-.96-1.536-2.592-2.112-4.896-2.112-2.208 0-3.84.864-3.84 2.304 0 1.344.864 1.824 2.88 2.112l2.304.384c3.264.528 5.04 1.824 5.04 4.608C24 21.696 21.6 24 18.996 24zM12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 2.4c5.28 0 9.6 4.32 9.6 9.6s-4.32 9.6-9.6 9.6S2.4 17.28 2.4 12 6.72 2.4 12 2.4z"/>
              </svg>
            <% } else if (platform.platform === 'soundcloud') { %>
              <svg viewBox="0 0 24 24" fill="#FF5500">
                <path d="M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.104.101.104.053 0 .094-.046.101-.104l.262-2.105-.262-2.154c-.007-.057-.048-.1-.101-.1zm1.49.876c-.057 0-.103.058-.103.129l-.176 1.279.176 1.262c0 .071.046.129.103.129.059 0 .104-.058.104-.129l.207-1.262-.207-1.279c0-.071-.045-.129-.104-.129zm1.456.754c-.061 0-.111.063-.111.14l-.148 1.265.148 1.249c0 .077.05.139.111.139.063 0 .113-.062.113-.139l.168-1.249-.168-1.265c0-.077-.05-.14-.113-.14zm1.428 1.004c-.066 0-.12.067-.12.149l-.131 1.216.131 1.2c0 .082.054.148.12.148.068 0 .122-.066.122-.148l.148-1.2-.148-1.216c0-.082-.054-.149-.122-.149zm1.396.398c-.07 0-.127.07-.127.154l-.112 1.173.112 1.154c0 .084.057.154.127.154.072 0 .129-.07.129-.154l.127-1.154-.127-1.173c0-.084-.057-.154-.129-.154zm1.374.424c-.075 0-.135.074-.135.166l-.093 1.132.093 1.111c0 .092.06.165.135.165.077 0 .139-.073.139-.165l.106-1.111-.106-1.132c0-.092-.062-.166-.139-.166zm1.351.459c-.081 0-.146.077-.146.171l-.074 1.097.074 1.076c0 .094.065.17.146.17.083 0 .148-.076.148-.17l.084-1.076-.084-1.097c0-.094-.065-.171-.148-.171zm1.329.498c-.086 0-.155.081-.155.18l-.055 1.063.055 1.043c0 .099.069.18.155.18.088 0 .157-.081.157-.18l.062-1.043-.062-1.063c0-.099-.069-.18-.157-.18zm1.308.538c-.091 0-.164.085-.164.189l-.035 1.025.035 1.007c0 .104.073.188.164.188.093 0 .166-.084.166-.188l.04-1.007-.04-1.025c0-.104-.073-.189-.166-.189zm1.285.577c-.096 0-.173.088-.173.196l-.016.987.016.969c0 .108.077.195.173.195.098 0 .175-.087.175-.195l.018-.969-.018-.987c0-.108-.077-.196-.175-.196zm1.263.616c-.101 0-.182.091-.182.203v1.911c0 .112.081.203.182.203.103 0 .184-.091.184-.203V12.67c0-.112-.081-.203-.184-.203zm1.242.654c-.106 0-.191.094-.191.209v1.87c0 .115.085.208.191.208.108 0 .193-.093.193-.208v-1.87c0-.115-.085-.209-.193-.209zm1.22.693c-.111 0-.2.097-.2.215v1.832c0 .118.089.214.2.214.113 0 .202-.096.202-.214v-1.832c0-.118-.089-.215-.202-.215zm1.198.731c-.116 0-.209.1-.209.221v1.794c0 .121.093.22.209.22.518 0 .938-.385.938-.863 0-.477-.42-.862-.938-.862z"/>
              </svg>
            <% } else if (platform.platform === 'bandcamp') { %>
              <svg viewBox="0 0 24 24" fill="#629AA0">
                <path d="M0 6.4l8.533 11.2H24L15.467 6.4z"/>
              </svg>
            <% } else { %>
              <!-- Fallback pour autres plateformes -->
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 5-5v10zm2-10v10l5-5-5-5z"/>
              </svg>
            <% } %>
          </div>
          <span class="platform-name">Écouter sur <%= platform.displayName %></span>
          <span class="platform-arrow" aria-hidden="true">↗</span>
        </a>
        <% }); %>
      </nav>
    </section>
    
    <!-- Footer glassmorphism -->
    <footer class="smartlink-footer">
      <p class="powered-by">
        Powered by <a href="<%= brandUrl %>" target="_blank" rel="noopener">MDMC Music Ads</a>
      </p>
      <p class="mdmc-tagline">Marketing musical qui convertit</p>
    </footer>
  </main>

  <!-- JavaScript pour Analytics et Audio Player -->
  <script>
    // ================================
    // MDMC SMARTLINKS - JavaScript moderne
    // Audio Player + Analytics + Interactions
    // ================================
    
    // Variables globales
    let audioPlayer;
    let playButton;
    let playIcon;
    let pauseIcon;
    let isPlaying = false;
    let audioTimer;
    
    // Initialisation au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
      initializeAudioPlayer();
      initializeAnimations();
    });
    
    // ================================
    // LECTEUR AUDIO
    // ================================
    function initializeAudioPlayer() {
      audioPlayer = document.getElementById('audioPlayer');
      playButton = document.getElementById('playButton');
      playIcon = document.getElementById('playIcon');
      pauseIcon = document.getElementById('pauseIcon');
      
      if (!audioPlayer || !playButton) return;
      
      // Event listeners
      playButton.addEventListener('click', togglePlayPause);
      audioPlayer.addEventListener('ended', onAudioEnded);
      audioPlayer.addEventListener('error', onAudioError);
      audioPlayer.addEventListener('loadstart', onAudioLoadStart);
      audioPlayer.addEventListener('canplay', onAudioCanPlay);
      
      // Si pas d'URL audio, masquer le bouton
      <% if (!track || !track.previewUrl) { %>
      playButton.style.display = 'none';
      <% } %>
    }
    
    function togglePlayPause() {
      if (!audioPlayer || !audioPlayer.src) {
        console.warn('Aucun fichier audio disponible');
        return;
      }
      
      if (isPlaying) {
        pauseAudio();
      } else {
        playAudio();
      }
    }
    
    function playAudio() {
      audioPlayer.play()
        .then(() => {
          isPlaying = true;
          updatePlayButton(true);
          trackAudioPlay();
          
          // Arrêt automatique après 30 secondes
          audioTimer = setTimeout(() => {
            pauseAudio();
          }, 30000);
        })
        .catch(error => {
          console.error('Erreur de lecture audio:', error);
          onAudioError();
        });
    }
    
    function pauseAudio() {
      audioPlayer.pause();
      isPlaying = false;
      updatePlayButton(false);
      
      if (audioTimer) {
        clearTimeout(audioTimer);
        audioTimer = null;
      }
    }
    
    function onAudioEnded() {
      isPlaying = false;
      updatePlayButton(false);
      trackAudioComplete();
      
      if (audioTimer) {
        clearTimeout(audioTimer);
        audioTimer = null;
      }
    }
    
    function onAudioError() {
      console.error('Erreur de chargement audio');
      playButton.style.opacity = '0.5';
      playButton.style.cursor = 'not-allowed';
    }
    
    function onAudioLoadStart() {
      playButton.style.opacity = '0.7';
    }
    
    function onAudioCanPlay() {
      playButton.style.opacity = '1';
      playButton.style.cursor = 'pointer';
    }
    
    function updatePlayButton(playing) {
      if (playing) {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        playButton.classList.add('playing');
        playButton.setAttribute('aria-label', 'Mettre en pause');
      } else {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
        playButton.classList.remove('playing');
        playButton.setAttribute('aria-label', 'Lire l\'extrait audio');
      }
    }
    
    // ================================
    // ANIMATIONS ET INTERACTIONS
    // ================================
    function initializeAnimations() {
      // Animation au survol des liens plateformes
      const platformLinks = document.querySelectorAll('.platform-link');
      platformLinks.forEach(link => {
        link.addEventListener('mouseenter', onPlatformHover);
        link.addEventListener('mouseleave', onPlatformLeave);
      });
      
      // Animation d'entrée progressive
      const animatedElements = document.querySelectorAll('.platform-link, .artwork-container, .track-info');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, { threshold: 0.1 });
      
      animatedElements.forEach(el => {
        observer.observe(el);
      });
    }
    
    function onPlatformHover(event) {
      const arrow = event.currentTarget.querySelector('.platform-arrow');
      if (arrow) {
        arrow.style.transform = 'translateX(6px)';
      }
    }
    
    function onPlatformLeave(event) {
      const arrow = event.currentTarget.querySelector('.platform-arrow');
      if (arrow) {
        arrow.style.transform = 'translateX(0)';
      }
    }
    
    // ================================
    // ANALYTICS ET TRACKING
    // ================================
    function trackPlatformClick(platform, artistSlug, trackSlug) {
      <% if (analyticsEnabled) { %>
      // Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'platform_click', {
          event_category: 'SmartLink',
          event_label: platform + ' - <%= artist.name %> - <%= track.title %>',
          platform: platform,
          artist_slug: artistSlug,
          track_slug: trackSlug,
          artist_name: '<%= artist.name %>',
          track_title: '<%= track.title %>',
          value: 1
        });
      }
      
      // Meta Pixel
      if (typeof fbq !== 'undefined') {
        fbq('track', 'Lead', {
          content_name: '<%= track.title %>',
          content_category: 'SmartLink',
          platform: platform
        });
      }
      <% } %>
      
      // Console log pour debug
      console.log('Platform click:', {
        platform: platform,
        artist: '<%= artist.name %>',
        track: '<%= track.title %>',
        url: event.target.href,
        timestamp: new Date().toISOString()
      });
    }
    
    function trackAudioPlay() {
      <% if (analyticsEnabled) { %>
      if (typeof gtag !== 'undefined') {
        gtag('event', 'audio_play', {
          event_category: 'SmartLink',
          event_label: '<%= artist.name %> - <%= track.title %>',
          artist_name: '<%= artist.name %>',
          track_title: '<%= track.title %>',
          value: 1
        });
      }
      
      if (typeof fbq !== 'undefined') {
        fbq('track', 'StartTrial', {
          content_name: '<%= track.title %>',
          content_category: 'Audio Preview'
        });
      }
      <% } %>
      
      console.log('Audio play:', {
        artist: '<%= artist.name %>',
        track: '<%= track.title %>',
        timestamp: new Date().toISOString()
      });
    }
    
    function trackAudioComplete() {
      <% if (analyticsEnabled) { %>
      if (typeof gtag !== 'undefined') {
        gtag('event', 'audio_complete', {
          event_category: 'SmartLink',
          event_label: '<%= artist.name %> - <%= track.title %>',
          artist_name: '<%= artist.name %>',
          track_title: '<%= track.title %>',
          value: 1
        });
      }
      <% } %>
      
      console.log('Audio complete:', {
        artist: '<%= artist.name %>',
        track: '<%= track.title %>',
        timestamp: new Date().toISOString()
      });
    }
    
    // Track page load time
    window.addEventListener('load', function() {
      const loadTime = performance.now();
      <% if (analyticsEnabled && gaId) { %>
      if (typeof gtag !== 'undefined') {
        gtag('event', 'timing_complete', {
          name: 'smartlink_load',
          value: Math.round(loadTime)
        });
      }
      <% } %>
      
      console.log('SmartLink loaded in', Math.round(loadTime), 'ms');
    });
    
    // Error tracking
    window.addEventListener('error', function(e) {
      console.error('SmartLink Error:', e.error);
      <% if (analyticsEnabled && gaId) { %>
      if (typeof gtag !== 'undefined') {
        gtag('event', 'exception', {
          description: 'SmartLink Error: ' + e.error?.message,
          fatal: false
        });
      }
      <% } %>
    });
    
    // ================================
    // OPTIMISATIONS PERFORMANCE
    // ================================
    
    // Lazy loading des images
    if ('loading' in HTMLImageElement.prototype) {
      const images = document.querySelectorAll('img[loading="lazy"]');
      images.forEach(img => {
        img.src = img.dataset.src;
      });
    } else {
      // Fallback pour navigateurs plus anciens
      const script = document.createElement('script');
      script.src = 'https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver';
      document.head.appendChild(script);
    }
    
    // Preconnect pour les domaines externes
    const preconnectDomains = [
      'https://fonts.googleapis.com',
      'https://fonts.gstatic.com'
    ];
    
    preconnectDomains.forEach(domain => {
      const link = document.createElement('link');
      link.rel = 'preconnect';
      link.href = domain;
      document.head.appendChild(link);
    });
    
    // Service Worker pour mise en cache (optionnel)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // navigator.serviceWorker.register('/sw.js');
      });
    }
    
    console.log('🎵 MDMC SmartLinks - Design moderne chargé avec succès');
  </script>
</body>
</html>