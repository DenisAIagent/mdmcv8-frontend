<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | MDMC SmartLinks</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="<%= description %>">
    <meta name="keywords" content="<%= artist.name %>, <%= track.title %>, musique, streaming, MDMC">
    <meta name="author" content="MDMC Music Ads">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="music.song">
    <meta property="og:title" content="<%= title %>">
    <meta property="og:description" content="<%= description %>">
    <meta property="og:image" content="<%= image %>">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="<%= url %>">
    <meta property="og:site_name" content="MDMC SmartLinks">
    <meta property="og:locale" content="fr_FR">
    
    <!-- Music Specific Open Graph -->
    <meta property="music:song" content="<%= track.title %>">
    <meta property="music:musician" content="<%= artist.name %>">
    <meta property="music:release_date" content="<%= new Date().toISOString() %>">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= title %>">
    <meta name="twitter:description" content="<%= description %>">
    <meta name="twitter:image" content="<%= image %>">
    <meta name="twitter:site" content="@MDMCMusicAds">
    <meta name="twitter:creator" content="@MDMCMusicAds">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="<%= url %>">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="<%= baseUrl %>/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="<%= baseUrl %>/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Analytics - Google Tag Manager (GTM) -->
    <% if (analyticsEnabled && gtmId) { %>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','<%= gtmId %>');</script>
    <% } %>

    <!-- Analytics - Google Analytics 4 -->
    <% if (analyticsEnabled && gaId) { %>
    <script async src="https://www.googletagmanager.com/gtag/js?id=<%= gaId %>"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '<%= gaId %>', {
            page_title: '<%= title %>',
            page_location: '<%= url %>',
            custom_map: {
                'custom_parameter_1': 'artist_name',
                'custom_parameter_2': 'track_title'
            }
        });
        
        // Track SmartLink view
        gtag('event', 'smartlink_view', {
            event_category: 'SmartLink',
            event_label: '<%= artist.name %> - <%= track.title %>',
            artist_name: '<%= artist.name %>',
            track_title: '<%= track.title %>',
            artist_slug: '<%= artist.slug %>',
            track_slug: '<%= track.slug %>'
        });
    </script>
    <% } %>
    
    <!-- Meta Pixel -->
    <% if (analyticsEnabled && metaPixelId) { %>
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '<%= metaPixelId %>');
        fbq('track', 'PageView');
        fbq('track', 'ViewContent', {
            content_type: 'music',
            content_name: '<%= track.title %>',
            content_category: 'SmartLink'
        });
    </script>
    <noscript>
        <img height="1" width="1" style="display:none" 
             src="https://www.facebook.com/tr?id=<%= metaPixelId %>&ev=PageView&noscript=1"/>
    </noscript>
    <% } %>

    <!-- TikTok Pixel -->
    <% if (analyticsEnabled && tiktokPixelId) { %>
    <script>
        !function (w, d, t) {
            w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
            ttq.load('<%= tiktokPixelId %>');
            ttq.page();
            ttq.track('ViewContent', {
                content_type: 'music',
                content_name: '<%= track.title %>',
                content_category: 'SmartLink'
            });
        }(window, document, 'ttq');
    </script>
    <% } %>

    <style>
        /* ================================
           MDMC SMARTLINKS - DESIGN MODERNE 2025
           Glassmorphism + Animations + UX Premium
           ================================ */
        
        /* Reset et Variables CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Couleurs MDMC */
            --mdmc-red: #cc271a;
            --mdmc-red-dark: #a61e14;
            --mdmc-red-light: #e63946;
            --mdmc-gradient: linear-gradient(135deg, #cc271a 0%, #e63946 100%);
            
            /* Couleurs modernes */
            --black: #000000;
            --white: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-bg-strong: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: rgba(0, 0, 0, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.85);
            --text-muted: rgba(255, 255, 255, 0.65);
            
            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            
            /* Radius */
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            --radius-2xl: 2rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 40px rgba(204, 39, 26, 0.3);
            
            /* Transitions */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Blur */
            --blur-sm: blur(4px);
            --blur-md: blur(8px);
            --blur-lg: blur(16px);
            --blur-xl: blur(24px);
        }
        
        /* Base */
        html {
            font-size: 16px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-family);
            font-weight: 400;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
        }
        
        /* Background avec artwork flou */
        .background-artwork {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: url('<%= image %>');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: var(--blur-xl);
            transform: scale(1.1);
            opacity: 0.3;
        }
        
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.8) 0%,
                rgba(26, 26, 26, 0.6) 30%,
                rgba(45, 45, 45, 0.7) 70%,
                rgba(0, 0, 0, 0.9) 100%
            );
        }
        
        /* Container principal - Glassmorphism Premium */
        .smartlink-container {
            width: 100%;
            max-width: 420px;
            backdrop-filter: var(--blur-md);
            -webkit-backdrop-filter: var(--blur-md);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            position: relative;
            animation: containerEntrance 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes containerEntrance {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(40px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* Header moderne avec artwork et player */
        .smartlink-header {
            position: relative;
            padding: var(--space-8) var(--space-6) var(--space-6);
            text-align: center;
            background: var(--glass-bg-strong);
            border-bottom: 1px solid var(--glass-border);
        }
        
        /* Artwork container avec bouton play intégré */
        .artwork-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto var(--space-6);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-base);
            animation: artworkEntrance 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        }
        
        @keyframes artworkEntrance {
            from {
                opacity: 0;
                transform: scale(0.8) rotateY(20deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
            }
        }
        
        .artwork-container:hover {
            transform: scale(1.02) rotateY(2deg);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }
        
        .cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: var(--transition-base);
        }
        
        .artwork-container:hover .cover-image {
            transform: scale(1.05);
        }
        
        /* Bouton Play sur l'artwork */
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: var(--glass-bg-strong);
            backdrop-filter: var(--blur-sm);
            -webkit-backdrop-filter: var(--blur-sm);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-bounce);
            z-index: 10;
            opacity: 0.9;
        }
        
        .play-button:hover {
            background: var(--mdmc-gradient);
            border-color: var(--mdmc-red-light);
            transform: translate(-50%, -50%) scale(1.1);
            opacity: 1;
            box-shadow: var(--shadow-glow);
        }
        
        .play-button:active {
            transform: translate(-50%, -50%) scale(0.95);
        }
        
        .play-icon {
            width: 32px;
            height: 32px;
            color: var(--white);
            margin-left: 3px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            transition: var(--transition-base);
        }
        
        .play-button.playing {
            background: var(--mdmc-gradient);
            border-color: var(--mdmc-red-light);
            animation: pulse 2s infinite;
        }
        
        .play-button.playing .play-icon {
            margin-left: 0;
            color: var(--white);
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 0.9; 
                box-shadow: var(--shadow-lg);
            }
            50% { 
                opacity: 1; 
                box-shadow: var(--shadow-glow);
            }
        }
        
        /* Audio Player (hidden) */
        .audio-player {
            display: none;
        }
        
        /* Track info avec animations */
        .track-info {
            animation: textEntrance 1s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
        }
        
        @keyframes textEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .track-info h1 {
            font-size: var(--font-size-3xl);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
            line-height: 1.1;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--white) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .track-info h2 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
            letter-spacing: -0.01em;
        }
        
        .track-subtitle {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            font-style: italic;
            font-weight: 400;
        }
        
        /* Content area */
        .smartlink-content {
            padding: 0 var(--space-6) var(--space-8);
        }
        
        .description {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: var(--space-8);
            line-height: 1.6;
            font-weight: 400;
        }
        
        /* Platform links - Design moderne avec vrais logos */
        .platforms-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .platform-link {
            display: flex;
            align-items: center;
            padding: var(--space-4) var(--space-5);
            background: var(--glass-bg);
            backdrop-filter: var(--blur-sm);
            -webkit-backdrop-filter: var(--blur-sm);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-lg);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
            animation: platformEntrance 0.8s cubic-bezier(0.4, 0, 0.2, 1) both;
        }
        
        <% if (typeof platforms !== 'undefined' && platforms.length > 0) { %>
        <% platforms.forEach((platform, index) => { %>
        .platform-link:nth-child(<%= index + 1 %>) { 
            animation-delay: <%= (index * 0.1) + 0.8 %>s; 
        }
        <% }); %>
        <% } %>
        
        @keyframes platformEntrance {
            from {
                opacity: 0;
                transform: translateX(-40px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .platform-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-slow);
        }
        
        .platform-link:hover::before {
            left: 100%;
        }
        
        .platform-link:hover {
            background: var(--glass-bg-strong);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }
        
        .platform-link:active {
            transform: translateY(-1px) scale(1.01);
        }
        
        /* Platform logos */
        .platform-logo {
            max-width: 40px;
            height: auto;
            margin-right: var(--space-4);
            flex-shrink: 0;
            transition: var(--transition-base);
            border-radius: var(--radius-sm);
            object-fit: contain;
            object-position: center;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        .platform-link:hover .platform-logo {
            transform: scale(1.1) rotate(5deg);
            animation: iconBounce 0.6s ease-in-out;
        }
        
        @keyframes iconBounce {
            0%, 100% { transform: scale(1.1) rotate(5deg) translateY(0); }
            50% { transform: scale(1.1) rotate(5deg) translateY(-3px); }
        }
        
        .platform-name {
            flex: 1;
            font-weight: 700;
            font-size: var(--font-size-lg);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .platform-arrow {
            margin-left: auto;
            transition: var(--transition-base);
            opacity: 0.7;
        }
        
        .platform-link:hover .platform-arrow {
            transform: translateX(6px);
            opacity: 1;
        }
        
        /* Couleurs spécifiques par plateforme */
        .platform-link.spotify:hover {
            border-color: #1DB954;
            box-shadow: 0 8px 24px rgba(29, 185, 84, 0.2);
        }
        
        .platform-link.apple-music:hover {
            border-color: #FA243C;
            box-shadow: 0 8px 24px rgba(250, 36, 60, 0.2);
        }
        
        .platform-link.deezer:hover {
            border-color: #A238FF;
            box-shadow: 0 8px 24px rgba(162, 56, 255, 0.2);
        }
        
        .platform-link.youtube-music:hover {
            border-color: #FF0000;
            box-shadow: 0 8px 24px rgba(255, 0, 0, 0.2);
        }
        
        .platform-link.amazon-music:hover {
            border-color: #00A8E1;
            box-shadow: 0 8px 24px rgba(0, 168, 225, 0.2);
        }
        
        .platform-link.tidal:hover {
            border-color: #000000;
            box-shadow: 0 8px 24px rgba(255, 255, 255, 0.1);
        }
        
        /* Footer glassmorphism */
        .smartlink-footer {
            padding: var(--space-6);
            background: var(--glass-bg);
            backdrop-filter: var(--blur-sm);
            -webkit-backdrop-filter: var(--blur-sm);
            text-align: center;
            border-top: 1px solid var(--glass-border);
            animation: footerEntrance 1s cubic-bezier(0.4, 0, 0.2, 1) 1.4s both;
        }
        
        @keyframes footerEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .powered-by {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            margin-bottom: var(--space-2);
            font-weight: 500;
        }
        
        .powered-by a {
            color: var(--mdmc-red-light);
            text-decoration: none;
            font-weight: 700;
            transition: var(--transition-fast);
        }
        
        .powered-by a:hover {
            color: var(--white);
            text-decoration: underline;
        }
        
        .mdmc-tagline {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            font-style: italic;
            opacity: 0.8;
            font-weight: 400;
        }
        
        /* Responsive Mobile-First */
        @media (max-width: 640px) {
            body {
                padding: var(--space-3);
            }
            
            .smartlink-container {
                max-width: 100%;
            }
            
            .smartlink-header {
                padding: var(--space-6) var(--space-5) var(--space-5);
            }
            
            .artwork-container {
                width: 200px;
                height: 200px;
                margin-bottom: var(--space-5);
            }
            
            .play-button {
                width: 70px;
                height: 70px;
            }
            
            .play-icon {
                width: 28px;
                height: 28px;
            }
            
            .track-info h1 {
                font-size: var(--font-size-2xl);
            }
            
            .track-info h2 {
                font-size: var(--font-size-lg);
            }
            
            .smartlink-content {
                padding: 0 var(--space-5) var(--space-6);
            }
            
            .platform-link {
                padding: var(--space-3) var(--space-4);
                font-size: var(--font-size-base);
            }
            
            .platform-logo {
                width: 36px;
                height: 36px;
                margin-right: var(--space-3);
                object-fit: contain;
                object-position: center;
            }
            
            .platform-name {
                font-size: var(--font-size-base);
            }
        }
        
        @media (max-width: 480px) {
            .artwork-container {
                width: 180px;
                height: 180px;
            }
            
            .track-info h1 {
                font-size: var(--font-size-xl);
            }
            
            .platform-link {
                padding: var(--space-3);
            }
            
            .platform-logo {
                width: 32px;
                height: 32px;
                object-fit: contain;
                object-position: center;
            }
        }
        
        /* Effet de particules subtil */
        .smartlink-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(204, 39, 26, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(230, 57, 70, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Amélioration de l'accessibilité */
        .platform-link:focus {
            outline: 2px solid var(--mdmc-red-light);
            outline-offset: 2px;
        }
        
        .play-button:focus {
            outline: 2px solid var(--mdmc-red-light);
            outline-offset: 4px;
        }
    </style>
</head>
<body>
    <!-- GTM NoScript -->
    <% if (analyticsEnabled && gtmId) { %>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=<%= gtmId %>"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <% } %>
    
    <!-- Background avec artwork flou -->
    <div class="background-artwork"></div>
    <div class="background-overlay"></div>
    
    <!-- Container principal -->
    <div class="smartlink-container">
        <!-- Header avec artwork et player -->
        <header class="smartlink-header">
            <div class="artwork-container">
                <img src="<%= image %>" 
                     alt="<%= track.title %> - <%= artist.name %>" 
                     class="cover-image"
                     loading="eager">
                <button class="play-button" id="playButton" aria-label="Lire la musique">
                    <i data-lucide="play" class="play-icon"></i>
                </button>
                <% if (track && track.audioUrl) { %>
                <audio class="audio-player" id="audioPlayer" preload="none">
                    <source src="<%= track.audioUrl %>" type="audio/mpeg">
                </audio>
                <% } %>
            </div>
            
            <div class="track-info">
                <h1><%= track.title %></h1>
                <h2><%= artist.name %></h2>
                <% if (track.subtitle) { %>
                <p class="track-subtitle"><%= track.subtitle %></p>
                <% } %>
            </div>
        </header>
        
        <!-- Contenu principal -->
        <main class="smartlink-content">
            <% if (description) { %>
            <p class="description">
                <%= description %>
            </p>
            <% } %>
            
            <!-- Liste des plateformes avec vrais logos -->
            <div class="platforms-list">
                <% if (typeof platforms !== 'undefined' && platforms.length > 0) { %>
                <% platforms.forEach(function(platform) { %>
                <a href="<%= platform.url %>" 
                   class="platform-link <%= platform.name.toLowerCase().replace(/\s+/g, '-') %>" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   data-platform="<%= platform.name.toLowerCase().replace(/\s+/g, '-') %>">
                    <% 
                    let logoPath = '';
                    const platformName = platform.name.toLowerCase();
                    if (platformName.includes('spotify')) {
                        logoPath = 'assets/logos/spotify.png';
                    } else if (platformName.includes('apple')) {
                        logoPath = 'assets/logos/apple-music.png';
                    } else if (platformName.includes('deezer')) {
                        logoPath = 'assets/logos/deezer.jpg';
                    } else if (platformName.includes('youtube')) {
                        logoPath = 'assets/logos/youtube-music.png';
                    } else if (platformName.includes('amazon')) {
                        logoPath = 'assets/logos/amazon-music.png';
                    } else if (platformName.includes('tidal')) {
                        logoPath = 'assets/logos/tidal.jpg';
                    } else {
                        logoPath = 'assets/logos/default.png';
                    }
                    %>
                    <img src="<%= logoPath %>" alt="<%= platform.name %>" class="platform-logo">
                    <span class="platform-name">PLAY</span>
                    <i data-lucide="play" class="platform-arrow"></i>
                </a>
                <% }); %>
                <% } %>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="smartlink-footer">
            <p class="powered-by">
                Powered by <a href="<%= brandUrl %>" target="_blank" rel="noopener noreferrer">MDMC Music Ads</a>
            </p>
            <p class="mdmc-tagline">
                Marketing musical qui convertit
            </p>
        </footer>
    </div>
    
    <script>
        // Initialisation des icônes Lucide
        lucide.createIcons();
        
        // Gestion du lecteur audio
        const playButton = document.getElementById('playButton');
        const audioPlayer = document.getElementById('audioPlayer');
        const playIcon = playButton.querySelector('.play-icon');
        
        let isPlaying = false;
        let audioTimer = null;
        
        playButton.addEventListener('click', function() {
            if (!isPlaying) {
                if (audioPlayer && audioPlayer.src) {
                    // Lecture du vrai fichier audio
                    audioPlayer.currentTime = 0;
                    audioPlayer.play().then(() => {
                        playButton.classList.add('playing');
                        playIcon.setAttribute('data-lucide', 'pause');
                        lucide.createIcons();
                        isPlaying = true;
                        
                        // Arrêter après 3 secondes maximum
                        audioTimer = setTimeout(() => {
                            stopPlayback();
                        }, 3000);
                    }).catch(error => {
                        console.log('Erreur lecture audio:', error);
                        // Fallback sur simulation si échec lecture
                        playButton.classList.add('playing');
                        playIcon.setAttribute('data-lucide', 'pause');
                        lucide.createIcons();
                        isPlaying = true;
                        audioTimer = setTimeout(() => { stopPlayback(); }, 3000);
                    });
                } else {
                    // Simulation si pas de fichier audio
                    playButton.classList.add('playing');
                    playIcon.setAttribute('data-lucide', 'pause');
                    lucide.createIcons();
                    isPlaying = true;
                    audioTimer = setTimeout(() => { stopPlayback(); }, 3000);
                }
            } else {
                stopPlayback();
            }
        });
        
        
        function stopPlayback() {
            // Arrêter l'audio si en cours de lecture
            if (audioPlayer && !audioPlayer.paused) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
            }
            
            playButton.classList.remove('playing');
            playIcon.setAttribute('data-lucide', 'play');
            lucide.createIcons();
            isPlaying = false;
            
            if (audioTimer) {
                clearTimeout(audioTimer);
                audioTimer = null;
            }
        }
        
        // Analytics de tracking (simulation)
        document.querySelectorAll('.platform-link').forEach(link => {
            link.addEventListener('click', function(e) {
                const platform = this.classList[1]; // spotify, apple-music, etc.
                console.log(`Clic sur ${platform} pour "<%= track.title %>" de <%= artist.name %>`);
                
                // Ici vous pourriez ajouter votre code de tracking réel
                // gtag('event', 'platform_click', {
                //     platform: platform,
                //     artist: '<%= artist.name %>',
                //     track: '<%= track.title %>'
                // });
            });
        });
        
        // Effet de parallaxe subtil sur le background
        document.addEventListener('mousemove', function(e) {
            const backgroundArtwork = document.querySelector('.background-artwork');
            if (backgroundArtwork) {
                const x = (e.clientX / window.innerWidth) * 100;
                const y = (e.clientY / window.innerHeight) * 100;
                
                backgroundArtwork.style.transform = `scale(1.1) translate(${x * 0.02}px, ${y * 0.02}px)`;
            }
        });
        
        // Préchargement des images pour une meilleure performance
        function preloadImages() {
            const imageUrls = [
                '<%= baseUrl %>/assets/logos/spotify.png',
                '<%= baseUrl %>/assets/logos/apple-music.png',
                '<%= baseUrl %>/assets/logos/deezer.jpg',
                '<%= baseUrl %>/assets/logos/youtube-music.png',
                '<%= baseUrl %>/assets/logos/amazon-music.png',
                '<%= baseUrl %>/assets/logos/tidal.jpg',
                '<%= baseUrl %>/assets/logos/soundcloud.png',
                '<%= baseUrl %>/assets/logos/bandcamp.png'
            ];
            
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
            });
        }
        
        // Lancer le préchargement au chargement de la page
        window.addEventListener('load', preloadImages);
        
        // Gestion du clavier pour l'accessibilité
        document.addEventListener('keydown', function(e) {
            if (e.key === ' ' && e.target === playButton) {
                e.preventDefault();
                playButton.click();
            }
        });
        
        // Détection de la performance et optimisation
        if ('connection' in navigator) {
            const connection = navigator.connection;
            if (connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g')) {
                // Réduire les animations pour les connexions lentes
                document.documentElement.style.setProperty('--transition-base', '0.1s');
                document.documentElement.style.setProperty('--transition-slow', '0.2s');
            }
        }
        
        // Si pas d'URL audio, masquer le bouton
        <% if (!track || !track.audioUrl) { %>
        if (playButton) {
            playButton.style.display = 'none';
        }
        <% } %>
    </script>
</body>
</html>